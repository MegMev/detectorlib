## Contributing changes to the repository with Git (WP)

- Describe the relevance of using a Git repository system to track changes.

- Philoshophy of minimal commit changes.

- Define commit message format

- Define the use of branches

## REST Versioning

The impact of changes in REST classes, i.e. adding, removing or modifying class members 
should be minimized by the use of `automatic schema evolution` feature of ROOT.

REST is compiled by default using `automatic schema evolution` since version `2.2.1`.
Therefore, any new/future generation of data before this version is `not recommended` for compatibility reasons.

Any data produced with version `2.2.1`, and later, will be generated using `automatic schema evolution`, and therefore,
any future REST version `should be able to read older versions` without major issues or warnings.

----

REST versioning system will allow to stamp the data generated with REST in order to identify new features 
or major changes to the code.

A change in REST version `serves to markdown an important step` in the evolution of the code. 

REST version might serve as `a solution to reproduce or recover previous results` which may show discrepancies with future versions, 
i.e. a version number will serve as reference and it can be provided together with published 
or internal results that were produced with a given version.

----

REST version might be increased in at least three different scenarios.

1. When new features are added (optional).

2. When changes or modifications affect the behaviour of the framework.

3. To fix a REST version release to produce data in a experiment physics run.


A version number increase will be optional but `may be justified` by the following updates to the code.

- New processes, metadata or event data types that introduce new funtionalities to REST.

- Important changes on REST core libraries that introduce new features.


A version number increase `will be mandatory` when the modification of existing processes or REST core libraries that change the behaviour and may lead to different results.


- leading to different results by modifying, upgrading or debugging of existing processes or REST classes

- modifying the structure of ROOT outputfile

- changes to metadata structures that REST users should be aware of


### Generating a new version number

REST uses the git tagging system to generate the REST version number at compilation time.

The basics of tagging in Git are described at the following site [GitLab tagging](https://git-scm.com/book/en/v2/Git-Basics-Tagging)

The version number must be written using the following format 2.X.Y, where X represents a major change or transition in the code,
and Y represents a minor change/correction/update of the code.

In order to change the version of REST we need to tag the state of the code using `git tag` command. Usually by increasing the value of Y.

I.e. if we are in version 2.2.1 we will upgrade the REST version to 2.2.2, indicating a message providing a clear clue of the reason of the new tagging version.
 
`git tag -a v2.2.2 -m "A small step for REST but a big step for humanity"`

Additionaly, to publish the new version and make it visible to other users we need to use the `--tags` flag when pushing the code.

`git push --tags`

Any tag character that is not a number will be ignored in the construction of the REST release and the REST version code.

I.e. the tag "v2.2.3b" will become "2.2.3", and the REST version code will be 131586.

Then, at REST compilation time this tag will be retrieved and the `TRestVersion.h` header will be produced containning the following information.

```

#ifndef REST_Version
#define REST_Version
/* Version information automatically generated by installer. *//*
 * These macros can be used in the following way:
 * 
 * #if REST_VERSION_CODE >= REST_VERSION(2,23,4)
 *     #include <newheader.h>
 * #else
 *     #include <oldheader.h>
 * #endif
 *
 */
#define REST_RELEASE "2.2.1"
#define REST_RELEASE_DATE "2018-11-01"
#define REST_RELEASE_TIME "07:40:41 +0800"
#define REST_GIT_COMMIT "a71c196f"
#define REST_GIT_BRANCH "v2.2.1"
#define REST_GIT_TAG "v2.2.1"
#define REST_VERSION_CODE 131585
#define REST_VERSION(a,b,c) (((a) << 16) + ((b) << 8) + (c))
#define REST_SCHEMA_EVOLUTION "OFF"
#endif

```

Any `TRestMetadata` class contains a member named `fVersion` that will be initialized using `TRestVersion.h` and that will be written 
to disk together with other metadata information.

The version of a metadata structure recovered from a ROOT file can be retrieved by using `GetVersion()` and  `GetVersionCode()` methods.
And it can be used to compare to the installed version of REST to identify if the version we are running is newer, older or the same as the one stored in disk.

```

TRestSpecificMetadataClass *md = (TRestSpecificMetadataClass *) file->Get("mdName");

if( md->GetVersionCode() > REST(2,2,1) )
    cout << "Yes. This metadata structure was generated with a version newer than 2.2.1!" << endl;

if( md->GetVersion() == REST_RELEASE )
    cout << "Yes. The REST version used to generate this metadata structure is the same as the installed REST version!" << endl;

```

This programming enables the REST users to take special actions need to be taken at a particular version or after a particular version.


